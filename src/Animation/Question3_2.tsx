import React, { useState } from 'react';
import { CommandTable } from '../CommandTable';
import { DebugTable } from '../DebugTable';
import { useKeyPress } from '../Functions';
import { useTimer } from '../Functions/useTimer';
import Style from '../style.module.scss';

const PPosition = (time: number): { cx: number; cy: number } => {
    const { sin, cos, PI } = Math;
    const base = { cx: 1038, cy: 865 };
    const radius = 450;
    const length = 160;
    const t = [0, 100, 120];
    if (time < t[0]) return base;
    else if (t[0] <= time && time < t[1])
        return {
            cx: base.cx + radius * (1 - cos(((time - t[0]) * PI) / ((t[1] - t[0]) * 2))),
            cy: base.cy + radius * sin(((time - t[0]) * PI) / ((t[1] - t[0]) * 2)),
        };
    else if (t[1] <= time && time < t[2])
        return {
            cx: base.cx + radius + (length * (time - t[1])) / (t[2] - t[1]),
            cy: base.cy + radius,
        };
    else
        return {
            cx: base.cx + radius + length,
            cy: base.cy + radius,
        };
};
const display = (time: number, settime: number) => {
    if (time < settime) return 'none';
    else return undefined;
};

export const Question3_2 = () => {
    const [speed, setSpeed] = useState(0);
    const { time, pause, reset, set } = useTimer();
    useKeyPress('Space', pause);
    useKeyPress('KeyS', pause);
    useKeyPress('KeyR', reset);
    useKeyPress('KeyQ', () => setSpeed((s) => s + 1));
    useKeyPress('KeyA', () => setSpeed((s) => s - 1));
    useKeyPress('KeyZ', () => setSpeed(0));
    useKeyPress('Digit1', reset);
    useKeyPress('Digit2', () => {
        reset();
        pause();
    });
    useKeyPress('Digit3', () => {
        set(120);
    });
    return (
        <div className={Style.AnimationContainer}>
            <DebugTable
                options={{
                    time: time,
                    speed: (2 ** speed).toPrecision(5),
                }}
            />
            <CommandTable
                options={{
                    '1': '初期状態',
                    '2': '小物体Pの運動',
                    '3': '台B上での摩擦力',
                    q: 'スピードアップ',
                    a: 'スピードダウン',
                    z: 'スピードリセット',
                    r: 'タイマーリセット',
                    s: 'タイマースタート',
                }}
            />
            <h1 className={Style.Title}>問3-2</h1>
            <svg
                className={Style.SVG}
                viewBox='0 0 4096 2755'
                fill='none'
                xmlns='http://www.w3.org/2000/svg'
            >
                <rect
                    y='1825'
                    width='4096'
                    height='200'
                    fill='#222222'
                    stroke='white'
                    strokeWidth='3'
                />
                <text
                    x='2048'
                    y='1925'
                    fill='white'
                    fontSize='100'
                    textAnchor='middle'
                    dominantBaseline='central'
                >
                    床
                </text>
                <circle
                    cx='3012'
                    cy='1765'
                    r='59.5'
                    fill='#222222'
                    stroke='white'
                    strokeWidth='3'
                />
                <path
                    d='M1143.5 1765C1143.5 1797.86 1116.86 1824.5 1084 1824.5C1051.14 1824.5 1024.5 1797.86 1024.5 1765C1024.5 1732.14 1051.14 1705.5 1084 1705.5C1116.86 1705.5 1143.5 1732.14 1143.5 1765Z'
                    fill='#222222'
                    stroke='white'
                    strokeWidth='3'
                />
                <path
                    d='M3328 1705V1465H768V1705H3328Z'
                    fill='#222222'
                    stroke='white'
                    strokeWidth='3'
                />
                <path
                    d='M1008 865H888V1465H1488V1345C1424.97 1345 1362.55 1332.58 1304.31 1308.46C1246.08 1284.34 1193.16 1248.98 1148.59 1204.41C1104.02 1159.84 1068.66 1106.92 1044.54 1048.69C1020.42 990.452 1008 928.035 1008 865Z'
                    fill='#222222'
                    stroke='white'
                    strokeWidth='3'
                />
                <rect
                    x='1488'
                    y='1345'
                    width='480'
                    height='120'
                    fill='#222222'
                    stroke='white'
                    strokeWidth='3'
                />
                <circle
                    {...PPosition(time * 2 ** speed)}
                    r='30'
                    stroke='white'
                    strokeWidth='3'
                    fill='#FF0000'
                />
                <g display={display(time * 2 ** speed, 120)}>
                    <rect
                        x='1488'
                        y='1345'
                        width='480'
                        height='120'
                        fill='#222222'
                        stroke='white'
                        strokeWidth='3'
                    />
                    <path
                        d='M1646 1345.01C1646 1346.11 1646.9 1347.01 1648 1347.01C1649.1 1347.01 1650 1346.11 1650 1345.01H1646ZM1649.41 1253.59C1648.63 1252.81 1647.37 1252.81 1646.59 1253.59L1633.86 1266.32C1633.08 1267.1 1633.08 1268.37 1633.86 1269.15C1634.64 1269.93 1635.91 1269.93 1636.69 1269.15L1648 1257.84L1659.31 1269.15C1660.09 1269.93 1661.36 1269.93 1662.14 1269.15C1662.92 1268.37 1662.92 1267.1 1662.14 1266.32L1649.41 1253.59ZM1650 1345.01V1255.01H1646V1345.01H1650Z'
                        fill='white'
                    />
                    <path
                        d='M1770 1465C1770 1466.1 1770.9 1467 1772 1467C1773.1 1467 1774 1466.1 1774 1465H1770ZM1773.41 1313.59C1772.63 1312.8 1771.37 1312.8 1770.59 1313.59L1757.86 1326.31C1757.08 1327.09 1757.08 1328.36 1757.86 1329.14C1758.64 1329.92 1759.91 1329.92 1760.69 1329.14L1772 1317.83L1783.31 1329.14C1784.09 1329.92 1785.36 1329.92 1786.14 1329.14C1786.92 1328.36 1786.92 1327.09 1786.14 1326.31L1773.41 1313.59ZM1774 1465V1315H1770V1465H1774Z'
                        fill='white'
                    />
                    <path
                        d='M1648 1341C1649.1 1341 1650 1340.1 1650 1339C1650 1337.9 1649.1 1337 1648 1337V1341ZM1586.59 1337.59C1585.8 1338.37 1585.8 1339.63 1586.59 1340.41L1599.31 1353.14C1600.09 1353.92 1601.36 1353.92 1602.14 1353.14C1602.92 1352.36 1602.92 1351.09 1602.14 1350.31L1590.83 1339L1602.14 1327.69C1602.92 1326.91 1602.92 1325.64 1602.14 1324.86C1601.36 1324.08 1600.09 1324.08 1599.31 1324.86L1586.59 1337.59ZM1648 1337H1588V1341H1648V1337Z'
                        fill='white'
                    />
                    <path
                        d='M1772 1467C1773.1 1467 1774 1466.1 1774 1465C1774 1463.9 1773.1 1463 1772 1463V1467ZM1710.59 1463.59C1709.8 1464.37 1709.8 1465.63 1710.59 1466.41L1723.31 1479.14C1724.09 1479.92 1725.36 1479.92 1726.14 1479.14C1726.92 1478.36 1726.92 1477.09 1726.14 1476.31L1714.83 1465L1726.14 1453.69C1726.92 1452.91 1726.92 1451.64 1726.14 1450.86C1725.36 1450.08 1724.09 1450.08 1723.31 1450.86L1710.59 1463.59ZM1772 1463H1712V1467H1772V1463Z'
                        fill='white'
                    />
                    <path
                        d='M1648 1349C1646.9 1349 1646 1349.9 1646 1351C1646 1352.1 1646.9 1353 1648 1353V1349ZM1709.41 1352.41C1710.2 1351.63 1710.2 1350.37 1709.41 1349.59L1696.69 1336.86C1695.91 1336.08 1694.64 1336.08 1693.86 1336.86C1693.08 1337.64 1693.08 1338.91 1693.86 1339.69L1705.17 1351L1693.86 1362.31C1693.08 1363.09 1693.08 1364.36 1693.86 1365.14C1694.64 1365.92 1695.91 1365.92 1696.69 1365.14L1709.41 1352.41ZM1648 1353H1708V1349H1648V1353Z'
                        fill='white'
                    />
                    <path
                        d='M1618 1339L1596 1411M1596 1411L1678 1351M1596 1411L1742 1465'
                        stroke='white'
                        strokeWidth='2'
                    />
                    <path
                        d='M1360.38 1404.68L1362.6 1409.96C1367.34 1408.04 1382.64 1401.5 1392.48 1401.5C1400.58 1401.5 1405.26 1406.42 1405.26 1412.72C1405.26 1425.02 1391.22 1429.76 1375.5 1430.18L1377.66 1435.16C1396.14 1434.14 1410.48 1427.18 1410.48 1412.84C1410.48 1402.76 1402.56 1397 1392.6 1397C1383.84 1397 1372.08 1401.32 1366.98 1402.94C1364.7 1403.66 1362.54 1404.26 1360.38 1404.68ZM1436.34 1388.66L1431.06 1388.48C1430.94 1390.1 1430.82 1391.84 1430.58 1393.64C1429.86 1398.5 1428.72 1407.32 1428.72 1413.02C1428.72 1416.92 1429.08 1420.28 1429.38 1422.56L1434 1422.2C1433.64 1419.2 1433.58 1417.16 1433.88 1414.82C1434.6 1406.96 1441.56 1396.04 1449.06 1396.04C1455.36 1396.04 1458.6 1402.88 1458.6 1412.36C1458.6 1427.42 1448.4 1432.76 1435.38 1434.68L1438.2 1439C1453.08 1436.3 1463.52 1428.98 1463.52 1412.3C1463.52 1399.7 1457.82 1391.72 1449.84 1391.72C1442.22 1391.72 1435.98 1399.22 1433.52 1405.34C1433.88 1401.14 1435.08 1393.04 1436.34 1388.66ZM1519.8 1420.76V1434.14H1492.26V1420.76H1519.8ZM1487.88 1440.62H1492.26V1438.16H1519.8V1440.62H1524.36V1416.74H1487.88V1440.62ZM1491 1405.28V1409.24H1521.06V1405.28H1491ZM1503.36 1385.96C1498.68 1393.64 1488.66 1402.76 1478.22 1408.04C1479.24 1409 1480.44 1410.56 1480.98 1411.58C1491.24 1406.12 1500.96 1397.6 1505.88 1390.28C1511.46 1397.96 1521.96 1406.36 1531.26 1411.22C1532.04 1409.96 1533.12 1408.4 1534.2 1407.38C1524.78 1403.12 1514.22 1394.78 1507.86 1385.96H1503.36ZM1579.2 1416.02C1579.2 1426.76 1568.94 1432.52 1554.36 1434.32L1557.06 1438.88C1572.6 1436.54 1584.3 1429.22 1584.3 1416.2C1584.3 1407.62 1577.94 1402.88 1569.42 1402.88C1562.52 1402.88 1555.68 1404.8 1551.48 1405.76C1549.68 1406.18 1547.64 1406.54 1545.96 1406.66L1547.52 1412.24C1548.96 1411.64 1550.7 1410.98 1552.56 1410.38C1556.1 1409.36 1561.98 1407.38 1568.94 1407.38C1575.12 1407.38 1579.2 1410.98 1579.2 1416.02ZM1554 1389.02L1553.22 1393.58C1560 1394.78 1572.12 1395.98 1578.78 1396.4L1579.5 1391.78C1573.62 1391.72 1560.6 1390.52 1554 1389.02Z'
                        fill='white'
                    />
                    <path
                        d='M1517.45 934.1H1506.47V930.32H1515.65V927.08H1506.47V923.48H1516.79V920.12H1506.47V914.78H1502.27V920.12H1492.19V923.48H1502.27V927.08H1493.33V930.32H1502.27V934.1H1491.05V937.52H1517.45V934.1ZM1498.55 956.12V951.74H1510.55V956.12H1498.55ZM1510.55 944.42V948.56H1498.55V944.42H1510.55ZM1514.51 941H1494.59V969.56H1498.55V959.3H1510.55V965.06C1510.55 965.78 1510.31 965.96 1509.59 965.96H1504.13C1504.67 966.92 1505.27 968.54 1505.45 969.56C1509.11 969.56 1511.21 969.5 1512.71 968.9C1514.09 968.24 1514.51 967.1 1514.51 965.12V941ZM1538.51 951.38H1531.61V944.72H1538.51V951.38ZM1531.61 934.46H1538.51V940.94H1531.61V934.46ZM1533.89 923.9C1532.63 926.18 1531.07 928.76 1529.51 930.74H1520.81C1522.49 928.76 1524.11 926.42 1525.55 923.9H1533.89ZM1546.31 940.94H1542.59V930.74H1533.89C1535.93 928.04 1538.03 924.8 1539.41 921.92L1536.71 920.18L1536.05 920.36H1527.47C1528.19 918.86 1528.85 917.3 1529.45 915.74L1525.55 914.78C1523.39 920.6 1519.79 926.36 1515.71 930.14C1516.67 930.74 1518.29 932 1519.01 932.72L1519.49 932.24V934.46H1527.41V940.94H1516.55V944.72H1527.41V951.38H1519.13V955.1H1527.41V964.4C1527.41 965.24 1527.17 965.48 1526.33 965.54C1525.55 965.54 1522.79 965.54 1519.79 965.42C1520.39 966.62 1520.99 968.42 1521.23 969.5C1525.31 969.5 1527.89 969.44 1529.45 968.78C1531.07 968.06 1531.61 966.8 1531.61 964.46V955.1H1538.51V957.44H1542.59V944.72H1546.31V940.94ZM1582.97 962.24V939.26H1602.41V934.88H1582.97V915.02H1578.35V962.24H1564.43V927.98H1559.87V962.24H1551.59V966.62H1605.11V962.24H1582.97ZM1628.81 918.26L1622.75 918.2C1623.11 919.94 1623.23 922.1 1623.23 924.32C1623.23 930.62 1622.63 945.8 1622.63 954.68C1622.63 964.46 1628.57 968.06 1637.21 968.06C1650.41 968.06 1658.15 960.5 1662.29 954.8L1658.87 950.72C1654.55 956.96 1648.37 963.14 1637.39 963.14C1631.69 963.14 1627.55 960.8 1627.55 954.2C1627.55 945.26 1627.97 931.1 1628.27 924.32C1628.33 922.34 1628.51 920.24 1628.81 918.26ZM1671.69 925.16L1672.23 930.38C1678.71 929 1694.01 927.56 1700.43 926.84C1694.91 930.14 1689.21 937.76 1689.21 947.12C1689.21 960.5 1701.87 966.44 1712.97 966.86L1714.71 961.88C1704.93 961.52 1694.01 957.8 1694.01 946.04C1694.01 938.96 1699.23 929.84 1707.75 927.08C1710.81 926.18 1716.09 926.12 1719.51 926.12V921.32C1715.49 921.5 1709.85 921.8 1703.31 922.4C1692.27 923.3 1680.93 924.44 1677.03 924.86C1675.89 924.98 1673.97 925.1 1671.69 925.16ZM1739.97 923.12L1734.15 923C1734.51 924.44 1734.57 926.96 1734.57 928.34C1734.57 931.82 1734.69 939.14 1735.23 944.36C1736.85 959.9 1742.31 965.54 1748.01 965.54C1752.03 965.54 1755.69 962.06 1759.29 951.86L1755.51 947.6C1753.95 953.6 1751.13 959.84 1748.07 959.84C1743.81 959.84 1740.87 953.18 1739.91 943.16C1739.49 938.18 1739.43 932.72 1739.49 928.94C1739.49 927.38 1739.73 924.56 1739.97 923.12ZM1771.23 924.8L1766.55 926.42C1772.31 933.44 1775.91 945.74 1776.99 956.6L1781.79 954.62C1780.89 944.48 1776.57 931.76 1771.23 924.8ZM1808.55 958.7C1808.55 956.6 1810.65 954.86 1813.35 954.86C1817.91 954.86 1820.91 958.28 1821.39 963.02C1819.89 963.26 1818.27 963.38 1816.53 963.38C1811.85 963.38 1808.55 961.58 1808.55 958.7ZM1800.87 920.78L1801.05 925.76C1802.31 925.58 1803.69 925.46 1805.01 925.4C1808.19 925.22 1820.19 924.68 1823.37 924.56C1820.31 927.26 1812.81 933.56 1809.45 936.32C1805.97 939.26 1798.29 945.68 1793.31 949.76L1796.73 953.3C1804.35 945.56 1809.69 941.3 1819.71 941.3C1827.51 941.3 1833.15 945.74 1833.15 951.62C1833.15 956.54 1830.45 960.02 1825.65 961.88C1824.93 956.18 1820.91 951.26 1813.41 951.26C1807.83 951.26 1804.17 954.92 1804.17 959.06C1804.17 964.04 1809.15 967.58 1817.31 967.58C1830.03 967.58 1837.95 961.34 1837.95 951.68C1837.95 943.58 1830.81 937.58 1820.85 937.58C1818.15 937.58 1815.27 937.88 1812.51 938.84C1817.19 934.94 1825.35 927.98 1828.35 925.7C1829.43 924.8 1830.63 924.02 1831.71 923.24L1828.95 919.76C1828.35 919.94 1827.51 920.12 1825.71 920.24C1822.53 920.54 1808.25 921.02 1805.13 921.02C1803.93 921.02 1802.25 920.96 1800.87 920.78ZM1865.07 918.32L1860.33 920.3C1863.09 926.84 1866.27 933.86 1869.03 938.78C1862.61 943.28 1858.65 948.14 1858.65 954.32C1858.65 963.32 1866.81 966.68 1878.09 966.68C1885.59 966.68 1892.49 965.96 1897.05 965.18V959.84C1892.37 961.04 1884.39 961.88 1877.85 961.88C1868.37 961.88 1863.63 958.76 1863.63 953.78C1863.63 949.22 1866.99 945.26 1872.57 941.66C1878.45 937.76 1886.73 933.8 1890.81 931.7C1892.55 930.8 1894.05 930.02 1895.43 929.18L1892.79 924.92C1891.53 925.94 1890.27 926.72 1888.53 927.74C1885.23 929.54 1878.75 932.72 1873.11 936.14C1870.47 931.4 1867.47 924.92 1865.07 918.32ZM1936.71 923.12C1936.83 923.6 1936.95 924.14 1937.13 924.62C1931.37 924.92 1924.53 924.74 1917.33 923.9L1917.63 928.28C1925.13 928.94 1932.45 929.06 1938.27 928.7C1938.75 930.14 1939.29 931.7 1939.89 933.38C1940.25 934.4 1940.67 935.42 1941.09 936.5C1934.31 937.1 1925.19 937.16 1916.19 936.2L1916.43 940.7C1925.67 941.36 1935.51 941.24 1942.83 940.58C1944.15 943.52 1945.71 946.46 1947.51 949.22C1945.59 948.98 1941.69 948.56 1938.51 948.2L1938.09 951.86C1942.23 952.34 1947.87 952.88 1951.23 953.78L1953.69 950.12C1952.85 949.28 1952.13 948.5 1951.47 947.54C1949.91 945.26 1948.53 942.68 1947.27 940.1C1951.47 939.5 1955.25 938.72 1958.13 937.94L1957.41 933.44C1954.59 934.34 1950.39 935.42 1945.41 936.02C1944.93 934.82 1944.45 933.56 1944.03 932.42C1943.61 931.16 1943.13 929.78 1942.71 928.28C1946.85 927.74 1951.11 926.84 1954.53 925.88L1953.87 921.56C1950.03 922.82 1945.83 923.72 1941.57 924.26C1940.91 921.86 1940.37 919.4 1940.13 917.12L1935.03 917.78C1935.63 919.46 1936.23 921.32 1936.71 923.12ZM1924.89 949.1L1920.21 948.14C1918.89 950.78 1917.81 953.3 1917.87 956.72C1917.93 964.4 1924.53 967.88 1936.29 967.88C1941.39 967.88 1946.13 967.52 1950.33 966.86L1950.51 962.06C1946.19 962.96 1941.81 963.32 1936.23 963.32C1926.81 963.32 1922.37 960.86 1922.37 955.88C1922.37 953.24 1923.45 951.2 1924.89 949.1Z'
                        fill='white'
                    />
                </g>
            </svg>
        </div>
    );
};
